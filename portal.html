<!DOCTYPE html>
<html>
<head>
  <title>GF Grievance Portal</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #fdf3f3;
      padding: 20px;
      max-width: 700px;
      margin: auto;
    }
    h1 {
      color: #d63384;
    }
    .rating span {
      font-size: 30px;
      cursor: pointer;
      margin: 5px;
      opacity: 0.5;
    }
    .rating span.selected {
      opacity: 1;
    }
    .file-preview {
      margin-top: 10px;
      max-height: 150px;
    }
    button {
      margin-top: 15px;
      background-color: #d63384;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    select, textarea, input[type="file"] {
      margin-top: 8px;
      margin-bottom: 12px;
      width: 100%;
    }
  </style>
</head>
<body>

  <h1>📝 GF Grievance Portal</h1>
  <p>Welcome, Her Highness. Kindly submit your royal complaints below.</p>

  <label>Royal Complaint:</label>
  <textarea id="grievance" rows="5" placeholder="Speak your heart, Queen."></textarea>

  <label>Category:</label><br>
  <input type="radio" name="category" value="Forgot Anniversary"> Forgot Anniversary<br>
  <input type="radio" name="category" value="Late Reply"> Late Reply<br>
  <input type="radio" name="category" value="Didn’t Call"> Didn’t Call<br>
  <input type="radio" name="category" value="Didn’t Notice New Dress"> Didn’t Notice New Dress<br>
  <input type="radio" name="category" value="Other"> Other<br>

  <label>Severity Rating (Emoji Style):</label>
  <div class="rating" id="emojiRating">
    <span data-rate="1">😐</span>
    <span data-rate="2">😤</span>
    <span data-rate="3">😡</span>
    <span data-rate="4">🤬</span>
    <span data-rate="5">💣</span>
  </div>
  <input type="hidden" id="rating">

  <label>Frequency of Offense:</label>
  <select id="frequency">
    <option value="Once">Once</option>
    <option value="Sometimes">Sometimes</option>
    <option value="Often">Often</option>
    <option value="Every Damn Time">Every Damn Time</option>
  </select>

  <label>Preferred Apology Method:</label>
  <select id="apology">
    <option value="Chocolate & Flowers">Chocolate & Flowers</option>
    <option value="Public Apology">Public Apology</option>
    <option value="Love Letter">Love Letter</option>
    <option value="Shopping Spree">Shopping Spree</option>
    <option value="Begging + Puppy Eyes">Begging + Puppy Eyes</option>
  </select>

  <label>Upload Evidence (Screenshot/Photo):</label>
  <input type="file" id="imageUpload" accept="image/*">
  <img id="preview" class="file-preview"><br>

  <button onclick="submitComplaint()">Submit Complaint 🚨</button>

  <p id="response" style="margin-top:20px;"></p>

  <script>
    // Emoji rating selection
    const emojiRating = document.querySelectorAll("#emojiRating span");
    emojiRating.forEach(span => {
      span.addEventListener("click", () => {
        emojiRating.forEach(s => s.classList.remove("selected"));
        span.classList.add("selected");
        document.getElementById("rating").value = span.dataset.rate;
      });
    });

    // Handle image preview
    let selectedFile = null;
    document.getElementById("imageUpload").addEventListener("change", function () {
      selectedFile = this.files[0];
      if (selectedFile) {
        const reader = new FileReader();
        reader.onload = e => document.getElementById("preview").src = e.target.result;
        reader.readAsDataURL(selectedFile);
      }
    });

    async function submitComplaint() {
      const complaint = document.getElementById("grievance").value;
      const category = document.querySelector("input[name='category']:checked");
      const rating = document.getElementById("rating").value;
      const frequency = document.getElementById("frequency").value;
      const apology = document.getElementById("apology").value;
      const username = localStorage.getItem("gfUser") || "Her Highness";

      if (!complaint || !category || !rating) {
        document.getElementById("response").innerText = "😤 Fill all the royal fields!";
        return;
      }

      const formData = new FormData();
      formData.append("username", username);
      formData.append("complaint", complaint);
      formData.append("category", category.value);
      formData.append("rating", rating);
      formData.append("frequency", frequency);
      formData.append("apology", apology);
      if (selectedFile) {
        formData.append("evidence", selectedFile);
      }

      const res = await fetch("http://localhost:3000/grievance", {
        method: "POST",
        body: formData
      });

      const result = await res.json();
      if (result.status === "success") {
        document.getElementById("response").innerText = "📬 Complaint filed successfully!";
        document.getElementById("grievance").value = "";
        emojiRating.forEach(s => s.classList.remove("selected"));
        document.getElementById("rating").value = "";
        document.getElementById("preview").src = "";
        document.getElementById("imageUpload").value = "";
      } else {
        document.getElementById("response").innerText = "🚨 Submission failed. Try again!";
      }
    }
  </script>
</body>
</html>
